<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping Cart | LuxuryBrand</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="/" class="nav-logo">LuxuryBrand</a>
            <div class="nav-menu">
                <a href="/#products" class="nav-link">Products</a>
                <a href="/#testimonials" class="nav-link">Testimonials</a>
                <a href="/#giveaway" class="nav-link">Giveaway</a>
                <a href="/#videos" class="nav-link">Videos</a>
                <a href="/#contact" class="nav-link">Contact</a>
                <a href="/cart" class="nav-link">Cart <span id="cart-indicator" class="cart-indicator"></span></a>
                <a href="/wishlist" class="nav-link">Wishlist <span id="wishlist-indicator" class="wishlist-indicator"></span></a>
                <a href="/admin" class="nav-link admin-btn">Admin</a>
            </div>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <div class="container" style="padding-top: 100px;">
        <h2 class="section-title">Your Shopping Cart</h2>
        
        <div id="cart-items">
            <!-- Cart items will be loaded via JavaScript -->
            <div class="empty-cart-message">
                <h3>Your cart is empty</h3>
                <p>Browse our collection and add some luxury items to your cart</p>
                <a href="/#products" class="cta-button">Continue Shopping</a>
            </div>
        </div>
        
        <div class="cart-totals" style="display: none;">
            <div class="cart-total">
                <span>Subtotal:</span>
                <span id="cart-subtotal">$0.00</span>
            </div>
            <div class="cart-total">
                <span>Shipping:</span>
                <span id="cart-shipping">$0.00</span>
            </div>
            <div class="cart-total">
                <span>Total:</span>
                <span id="cart-total">$0.00</span>
            </div>
            <a class="checkout-btn" href="/checkout">Proceed to Checkout</a>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
    // Simple cart functionality
    document.addEventListener('DOMContentLoaded', function() {
        updateCartDisplay();
    });

    function updateCartDisplay() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const cartItems = document.getElementById('cart-items');
        const cartTotals = document.querySelector('.cart-totals');
        
        if (cart.length === 0) {
            cartItems.innerHTML = `
                <div class="empty-cart-message">
                    <h3>Your cart is empty</h3>
                    <p>Browse our collection and add some luxury items to your cart</p>
                    <a href="/#products" class="cta-button">Continue Shopping</a>
                </div>
            `;
            cartTotals.style.display = 'none';
            return;
        }
        
        // Show cart items
        cartItems.innerHTML = '';
        let subtotal = 0;
        
        cart.forEach(item => {
            const itemTotal = item.price * item.quantity;
            subtotal += itemTotal;
            
            const cartItem = document.createElement('div');
            cartItem.className = 'cart-item';
            cartItem.innerHTML = `
                <img src="https://via.placeholder.com/80x80?text=Product" alt="${item.name}">
                <div class="cart-item-info">
                    <h4>${item.name}</h4>
                    <div class="cart-item-price">$${item.price.toFixed(2)}</div>
                    <div class="cart-item-quantity">
                        <button class="quantity-btn" onclick="updateQuantity('${item.id}', -1)">-</button>
                        <input type="number" class="quantity-input" value="${item.quantity}" min="1" 
                               onchange="updateQuantity('${item.id}', 0, this.value)">
                        <button class="quantity-btn" onclick="updateQuantity('${item.id}', 1)">+</button>
                    </div>
                    <button class="remove-item" onclick="removeFromCart('${item.id}')">
                        <i class="fas fa-trash"></i> Remove
                    </button>
                </div>
            `;
            cartItems.appendChild(cartItem);
        });
        
        // Update totals
        document.getElementById('cart-subtotal').textContent = `$${subtotal.toFixed(2)}`;
        document.getElementById('cart-total').textContent = `$${subtotal.toFixed(2)}`;
        cartTotals.style.display = 'block';
    }

    function updateQuantity(productId, change, newValue = null) {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        const item = cart.find(item => item.id === productId);
        
        if (item) {
            if (newValue !== null) {
                item.quantity = parseInt(newValue);
            } else {
                item.quantity += change;
            }
            
            if (item.quantity < 1) {
                removeFromCart(productId);
                return;
            }
            
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartDisplay();
            updateCartCount();
        }
    }

    function removeFromCart(productId) {
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        cart = cart.filter(item => item.id !== productId);
        localStorage.setItem('cart', JSON.stringify(cart));
        updateCartDisplay();
        updateCartCount();
    }

    // Checkout function
    function checkout() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        if (cart.length === 0) {
            alert("Your cart is empty!");
            return;
        }

        fetch("/checkout", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ cart: cart })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                localStorage.removeItem('cart'); // clear cart
                alert("Checkout successful! Order ID: " + data.order_id);
                window.location.href = "/thank-you"; // redirect to thank-you page
            } else {
                alert("Checkout failed: " + data.message);
            }
        })
        .catch(error => {
            console.error("Error during checkout:", error);
            alert("Something went wrong. Please try again.");
        });
    }
    </script>
</body>
</html>
